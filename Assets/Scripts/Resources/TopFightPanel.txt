--[[
    @desc: 控制战斗界面
    @author:yxy
]]
UnityEngine.Time.fixedDeltaTime = 0.1
local TopFightPanel = TopFightPanel or {}
function TopFightPanel:new()
    o = o or {}
    setmetatable( o, { __index = self }) 
    return o  
end

function TopFightPanel:Init()
    EventSystem:GetInstance():init()
    EventSystem:GetInstance():AddListener("Hello",function()  self:UpdateRound() end)
    local EventName  = EventSystem:GetInstance().EventName

    --获得当前关卡
    local level = 1
    --生成关卡数据
    self:InitData(level)
    --生成Panel
    self:InitPanel()
    Debug.Log(" TopFightPanel:Init")
end

function TopFightPanel:InitData()
    self.EnemyData = {}
    self.PlayerData= {}
    self.RoundData = {}  --这个是消消乐每回合传递过来的数据
    self.EnemyData = require "EnemyData"
    self.PlayerData= require "PlayerData"
end

function TopFightPanel:InitPanel()
    --获得组件
    self.Player = GameObject.Find("GuildCrushWindow/TopPanel/Player")
    self.Boss   = GameObject.Find("GuildCrushWindow/TopPanel/Boss")
    --怪物倒计回合
    local AttackCountDown_text = GameObject.Find("GuildCrushWindow/TopPanel/Boss/AttackCountDown/AttackCountDown_text"):GetComponent(Text)
    AttackCountDown_text.text = self.EnemyData.FightRound
    
    self.Hp_text     = GameObject.Find("GuildCrushWindow/TopPanel/UIState/Hp_text"):GetComponent(Text)
    self.Energy_text = GameObject.Find("GuildCrushWindow/TopPanel/UIState/Energy_text"):GetComponent(Text)
    self.Shield_text = GameObject.Find("GuildCrushWindow/TopPanel/UIState/Shield_text"):GetComponent(Text)
    self.Level_text  = GameObject.Find("GuildCrushWindow/TopPanel/UIState/Shield_text"):GetComponent(Text)

    self.Hp_text.text    = self.PlayerData.HP_cur    .. "/" .. self.PlayerData.Hp_total
    self.Energy_text.text= self.PlayerData.Energy_cur.. "/" .. self.PlayerData.Energy_total
    self.Shield_text.text= self.PlayerData.Shield_cur.. "/" .. self.PlayerData.Shield_total
    self.Level_text.text = 1
    PlayerMove()
end

--更新回合数据（通过事件访问）
function TopFightPanel:UpdateRound()
    Debug.Log("执行UpdateRound")
end

function PlayerMove()
    local offset = Vector3(0,0,1)
end
return TopFightPanel